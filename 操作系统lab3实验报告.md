#操作系统Lab3实验报告
##14231036 袁梦阳
###一、实验思考题


 >**Thinking 3.1** 什么我们在构造空闲进程链表时使用了逆序插入的方式?   
 
* 连标插入是每次向表头后面插入，所以你许插入使得链表是正序。

>**Thinking 3.2** 思考 env_ setup_ vm 函数:  
1. 第三点注释中的问题: 为什么我们要执行pgdir[i] = boot_pgdir[i]这个赋值操作?换种说法,我们为什么要使用boot_pgdir作为一部分模板  (提 示:mips 虚拟空间布局)   
2. UTOP 和 ULIM 的含义分别是什么,在 UTOP 到 ULIM的区域与其他用户区相比有什么最大的区别??   
3. (选做) 我们为什么要让pgdir[PDX(UVPT)]=env_cr3?(提示: 结合系统自映射机制)


1. 因为页表和进程的虚拟地址全部排布映射完毕并且入口在boot_pgdir。
2. ULIM时用户台程序可访问地址的上限。UTOP是用户有权写的地址的上限。、
3. cr3是x86架构下的控制寄存器，可以快速赋予进程页表目录地址。

>**Thinking 3.3** 思考 user_data 这个参数的作用。没有这个参数可不可以?为什么?(如果你能说明哪些应用场景中可能会应用这种设计就更好了。可以举一个实际的库中的例子)

* **不能没有。**在load_elf中，将load_icode_mapper传入，userdata中的数据并不是传给load_elf里使用的,而是传个load_elf中调用的load_icode_mapper使用的。


>**Thinking 3.4** 思考上面这一段话,并根据自己在 lab2 中的理解,回答:  • 我们这里出现的” 指令位置” 的概念,你认为该概念是针对虚拟空间,还是物理内存所定义的呢?  • 你觉得entry_point其值对于每个进程是否一样?该如何理解这种统一或不同?  • 从布局图中找到你认为最有可能是entry_point的值。  

1. 物理空间。
2. 一样。简化了mips对于程序的读取。
3. 在UTEXT+0xb0处。 

>**Thinking 3.5** 思考一下,要保存的进程上下文中的env_tf.pc的值应该设置为多少? 为什么要这样设置?  

* epc寄存器中保存了中断后返回pc的值。在env_tf.pc中，将TIMESTACK拷贝到old中，并将old中的epc存入当前进程的pc中。 

 
>**Thinking 3.6** 思考 TIMESTACK 的含义,并找出相关语句与证明来回答以下关于TIMESTACK的问题:  • 请给出一个你认为合适的 TIMESTACK 的定义  • 请为你的定义在实验中找出合适的代码段作为证据 (请对代码段进行分析)   • 思考TIMESTACK 和第 18 行的 KERNEL_SP 的含义有何不同  

1. 记录当前环境各寄存器数据的栈。




>**Thinking 3.7** 思考一下你的调度程序,这种调度方式由于某种不可避免的缺陷而造 成对进程的不公平。  • 这种不公平是如何产生的?  • 如果实验确定只运行两个进程,你如何改进可以降低这种不公平?  

* 顺序遍历中，检验后边不可运行的进程的时间算入第一个进程的时间片中，使得第一个进程的可运行时间少于第二个。
* 使得遍历数量减少。 


###二、实验难点

本实验的难点主要集中在load_icode_mapper和env_run上。以及其他的汇编代码的阅读。

**难点：** 
 
1. 汇编代码的阅读。  
2. 在envrun中，思考清楚程序切换的过程。

###三、体会与感想
在做实验的过程中，接触到的新的事物感到费解，尤其是很多实验无法知道自己的结果是否正确。在知道判断方法之后，经过尝试，实验就easy很多。

